<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Configuration Page</title>

<script type="text/javascript">
	$('#postData').click(function(e) {
		e.preventDefault();
		var filepath = document.getElementById("filepath").value;
		if(filepath==null || filepath==""){
			//alert("Please enter valid SNOMED CT Release filepath");
			pop('popDiv',"Please enter valid SNOMED CT Release filepath","true");
			return;
		}
		
		//alert("Please wait. It may take few minutes to save configuration and to create database and index.");
		pop('popDiv',"Please wait. It may take few minutes for DB and Index creation.","");
		
		
		var getUrl = window.location;
		var path = getUrl.pathname.split('/');
		var count = path.length;
		//var baseUrl = getUrl .protocol + "/" + getUrl.host;
		var baseUrl = location.protocol + "//" + getUrl.host;

		//for(var i=0; i<count-1; i++){
		for (var i = 1; i < count - 1; i++) {
			baseUrl = baseUrl + "/" + path[i];
			//alert(baseUrl);
		}
		baseUrl = baseUrl + "/api/add/config";

		$("#configForm input, #configForm select").attr('readonly',true);
		$('#postData').prop('disabled', true);
		$.ajax({
			url : baseUrl,
			type : 'POST',
			//dataType : 'html/text',
			data : $('#configForm').serialize(),
			success : function(data, textStatus, jqXHR) {
				//$('#configForm').submit();
				pop('popDiv',"Form Submitted Successfully.","");
				$('#menubar').show();
				$('#maincontent').load("pages/home.html");
			},
			error : function(jqXHR, textStatus, errorThrown) {
					pop('popDiv',jqXHR.responseText,"failed");
				$("#configForm input, #configForm select").attr('readonly',false);
				
				$('#postData').prop('disabled', false);
		}
		});

		
	});
	
	function expandCollapse(id){
		$('#'+id).toggleClass('expand').nextUntil('tr.theader').slideToggle(100);
	}
	
	function validateLimit(returnId) {	

	//if return limit exceeds 6 digits
	if(document.getElementById(returnId).value.length == 6)
		{
	temp=document.getElementById(returnId).value;
		}
	else if(document.getElementById(returnId).value.length > 6)
		{
	alert("Enter Return Limit in 6 digits");
	console.log(" temp : "+temp);
	document.getElementById(returnId).value=temp;
		}
	else{
	document.getElementById(returnId).value = document.getElementById(returnId).value.replace(/[^0-9]/g, '');
		}
	}     


</script>
<script type="text/javascript">
			function pop(div,logpath,msg) {				
				var error=logpath.split('|');
				document.getElementById('popuplabel').innerHTML=error[0];				
				if(typeof error[1]!='undefined')
					document.getElementById('logpathlabel').innerHTML=error[1];				
				document.getElementById(div).style.display = 'block';
			}
			
			//
			function hidePOPDiv(div){		
					//document.getElementById("okbtn").style.display = 'none';		
					$("#popDiv").hide();				
			}
				
			
			 
			//To detect escape button
			document.onkeydown = function(evt) {
				evt = evt || window.event;
				if (evt.keyCode == 27) {
					hide('popDiv');
				}
			};
		</script>
		<style>
			.ontop {
				z-index: 999;
				width: 100%;
				height: 100%;
				top: 0;
				left: 0;
				display: none;
				position: fixed;				
				background-color: #cccccc;
				color: #aaaaaa;
				opacity: .9;
				filter: alpha(opacity = 50);
				overflow: auto;
			}
			#popup {
				width: 400px;
				height: 90px;
				position: absolute;
				color: #000000;
				background-color: #ffffff;
				/* To align popup window at the center of screen*/
				top: 50%;
				left: 50%;
				margin-top: -100px;
				margin-left: -150px;
				border-radius: 10px
			}

		</style>
	
</head>
<body>



	<div class="bar">Configuration Details -</div>

		
	<div class="detailbar">
		<span class="headings">Description -</span> 
		<span class="simpletext">Please
			provide the database configuration details. In case any value is
			skipped (except SNOMED CT International Release File Path) then default value will be used internally. However, to reset
			the values, modify the config.flag value to true in properties file.</span>
		<br />
		<span class="headings">Form -</span> <br />

		<form action="index.html" method="post" id="configForm">
		<table>
			<tr  id="snomedDBTable" class="theader expand" onclick="expandCollapse('snomedDBTable');"><th><span style="text-align: right;" class="sign"></span> SNOMED CT Database Details</th></tr>
			<tr>
				<td>Data Directory <font color="red" size="3.5">*</font>: </td>
				<td class="tooltip"><input type="text" id="data.directory"
				name="data.directory" placeholder="e.g. C:/CSNOtk/DataDir" /><span class="tooltiptext">Enter system directory path for creating database and index files.</span></td>
			</tr>
			<tr>
				<td>Log Directory <font color="red" size="3.5">*</font>: </td>
				<td class="tooltip"><input type="text"
				id="log.directory" name="log.directory" placeholder="e.g. C:/CSNOtk/LogDir" /><span class="tooltiptext">Enter system directory path for creating logs.</span></td>
			</tr>
			<tr>
				<td>Search Return Limit: </td>
				<td><input type="number" id="searchReturnlimit" name="searchReturnlimit" onkeyup="validateLimit('searchReturnlimit');" placeholder="e.g. 1000" /></td>
			</tr>
			<tr>
				<td>Suggest Return Limit: </td>
				<td><input type="number" id="suggestReturnlimit" name="suggestReturnlimit" onkeyup="validateLimit('suggestReturnlimit');" placeholder="e.g. 500" /></td>
			</tr>
			<tr>
				<td>Top Suggest Return Limit: </td>
				<td><input type="number"
				id="topSuggestReturnlimit" name="topSuggestReturnlimit" onkeyup="validateLimit('topSuggestReturnlimit');" placeholder="e.g. 100" /></td>
			</tr>
			<tr>
				<td>Release File Path <font color="red" size="3.5">*</font>: </td>
				<td class="tooltip"><input type="text" id="filepath" name="filepath" placeholder="e.g. C:/SNOMEDCT_INT/Snapshot" /><span class="tooltiptext">Enter SNOMED CT International Release file path till Snapshot.</span></td>
			</tr>
			<tr>
				<td>
					<input type="hidden" id="snomedctDB" name="snomedctDB" value="true" />
				</td>
			</tr>
			
			<tr id="icdDBTable" class="theader expand" onclick="expandCollapse('icdDBTable');"><th><span style="text-align: right;" class="sign"></span> ICD-10 Database Details</th></tr>
			<tr>
				<td>JDBC Url: </td>
				<td class="tooltip"><input type="text" id="jdbc_url_icd" name="jdbc_url_icd" placeholder="e.g. jdbc:mysql://localhost:3306/icd10" /><span class="tooltiptext">Enter JDBC URL for connecting to external ICD-10 database (on same or other machine).</span></td>
			</tr>
			<tr>
				<td>DB Username: </td>
				<td class="tooltip"><input type="text" id="icd.db.username" name="icd.db.username" placeholder="e.g. root" /><span class="tooltiptext">Enter database username for connecting to external ICD-10 database.</span></td>
			</tr>
			<tr>
				<td>DB Password: </td>
				<td class="tooltip"><input type="password" id="icd.db.password" name="icd.db.password" placeholder="e.g. password" /><span class="tooltiptext">Enter database password for provided user for connecting to external ICD-10 database.</span></td>
			</tr>
			<tr>
				<td>JDBC Driver ClassName: </td>
				<td class="tooltip"><input type="text" id="icd.jdbc.driver.class" name="icd.jdbc.driver.class" placeholder="e.g. com.mysql.jdbc.Driver" /><span class="tooltiptext">Enter JDBC classname to be loaded for connecting to external ICD-10 database.</span></td>
			</tr>
			<tr>
				<td>JAR Name: </td>
				<td class="tooltip"><input type="text" id="icd.jar.name" name="icd.jar.name" placeholder="e.g. mysql-connector-java-5.1.13-bin" /><span class="tooltiptext">Enter JAR name for connecting to external ICD-10 database.</span></td>
			</tr>
			<tr>
				<td>ICD-10 Table Name: </td>
				<td class="tooltip"><input type="text" id="icd.db.tablename" name="icd.db.tablename" placeholder="e.g. tbl_icd" /><span class="tooltiptext">Enter ICD-10 table name as in ICD-10 database.</span></td>
			</tr>
			<tr>
				<td>ICD-10 Term ColumnName: </td>
				<td class="tooltip"><input type="text" id="icd.db.term.column" name="icd.db.term.column" placeholder="e.g. term" /><span class="tooltiptext">Enter column name for ICD-10 Term as in ICD-10 table.</span></td>
			</tr>
			<tr>
				<td>ICD-10 Code ColumnName: </td>
				<td class="tooltip"><input type="text" id="icd.db.code.column" name="icd.db.code.column" placeholder="e.g. code" /><span class="tooltiptext">Enter column name for ICD-10 Code as in ICD-10 table.</span></td>
			</tr>
			
  		</table>	
			<button type="button" value="Submit" id="postData">Submit</button>
			
			<div id="popDiv" class="ontop" >
			<table border="1" id="popup">
				<tr>
					<td style="text-align: center;">
						<label id="popuplabel"></label>
						</br> <label id="logpathlabel"></label>
						</br>
						<input type="button" id="okbtn" onclick="hidePOPDiv(this)" value="OK" style="width: 45px; background-color: cornflowerblue;color: white;"> </input><!--  onclick="hide('popDiv')"-->
					</td>
				</tr>
				
			</table>
		</div>
		</form>
	</div>
	
</body>
</html>